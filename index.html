<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Critical Path Controls | K2 Consulting</title>
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="images/site-icons/32_32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="images/site-icons/192_192.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="images/site-icons/180_180.png"
    />
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="stylesheet" href="styles/navigation.css" />
    <link rel="stylesheet" href="styles/breadcrumb.css" />
    <link rel="stylesheet" href="styles/services.css" />
    <link rel="stylesheet" href="styles/modal.css" />
    <link rel="stylesheet" href="styles/forms.css" />
    <link rel="stylesheet" href="styles/index.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    
    <!-- Modal CSS fixes -->
    <style>
      /* Ensure modals appear on top of everything */
      .modal-backdrop {
        z-index: 9998 !important;
        position: fixed !important;
        visibility: visible !important;
      }
      
      .modal-overlay {
        z-index: 9999 !important;
        position: fixed !important;
        visibility: visible !important;
      }
      
      .modal-overlay.show {
        display: flex !important;
        opacity: 1 !important;
        pointer-events: auto !important;
      }
      
      .modal-container {
        z-index: 10000 !important;
        background-color: white !important;
        opacity: 1 !important;
        visibility: visible !important;
      }
      
      /* Ensure the modal content is visible when shown */
      .modal-overlay.show .modal-container {
        opacity: 1 !important;
        transform: translateY(0) !important;
        pointer-events: auto !important;
      }
      
      /* Style for the service detail sections */
      .service-detail-section {
        padding-top: 40px;    /* Reduced from 60px */
        padding-bottom: 40px; /* Reduced from 60px */
        padding-left: 0;
        padding-right: 0;
        scroll-margin-top: 80px; /* Added: Offset for fixed header. Adjust value as needed. */
      }
      /* Add separator line between main service detail sections */
      .service-detail-section + .service-detail-section {
          border-top: 1px solid #ddd; 
          margin-top: 15px;    /* Reduced from 30px */
          padding-top: 40px;   /* Reduced from 60px */
      }

      .service-detail-section h2.detail-section-title {
        text-align: center;
        margin-bottom: 20px; /* Reduced from 40px */
        font-size: 2.5em;
        color: var(--primary-color);
      }
      
      /* Sub-section headings within detail sections */
      .service-detail-section h3.detail-subsection-title {
           text-align: center; 
           margin-top: 10px;    /* Further reduced from 20px */
           margin-bottom: 20px; 
           font-size: 1.8em; 
           color: var(--secondary-color);
       }
       
       /* Reduce padding for inner sections within detail blocks */
       .service-detail-section .service-section {
           padding-top: 10px;    /* Further reduced from 20px */
           padding-bottom: 10px; /* Further reduced from 20px */
           /* This overrides general .service-section padding */
       }
       
       /* Layout for 4 service offering cards per row */
       @media (min-width: 992px) { 
           .service-offering-grid {
               grid-template-columns: repeat(4, 1fr);
               gap: 15px; 
           }
           .service-offering-grid .detail-card.service-offering-card {
                padding: 15px; 
           }
            .service-offering-grid .detail-card.service-offering-card h3 {
                 font-size: 1.1em; 
            }
            .service-offering-grid .detail-card.service-offering-card p {
                 font-size: 0.9em; 
                 min-height: 100px; 
            }
            .service-offering-grid .detail-card.service-offering-card .btn {
                 padding: 8px 12px; 
                 font-size: 0.9em;
            }
       }

       /* Ensure background videos in detail sections don't overlay content inappropriately */
       .service-section.with-video {
         position: relative;
         overflow: hidden; /* Contain the video */
       }
        .service-section.with-video .container {
         position: relative; /* Ensure content stays above video */
         z-index: 2;
       }
        .background-video {
          position: absolute;
          top: 50%;
          left: 50%;
          min-width: 100%;
          min-height: 100%;
          width: auto;
          height: auto;
          object-fit: cover;
      }
      
      /* Combined FAQ specific styles */
      #combined-faq-section {
          padding: 60px 0;
          background-color: #f9f9f9; /* Optional: Light background for separation */
      }
      #combined-faq-section h2 {
           text-align: center;
           margin-bottom: 40px;
           font-size: 2.2em;
           color: var(--primary-color);
      }
      
      /* Ensure final CTA heading is centered */
      #main-cta-section h2 {
             text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- Include centralized navigation -->
    <div id="navigation"></div>

    <!-- Include breadcrumb -->
    <div id="breadcrumb"></div>

    <main>
      <section class="service-hero">
        <div class="hero-content">
          <h1>Critical Path Controls</h1>
          <p>
            Delivering excellence in project controls and management solutions
          </p>
        </div>
      </section>

      <section class="metrics-section">
        <div class="container">
          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-image">
                <img
                  src="images/stats-experience.jpg"
                  alt="Years of Experience"
                />
              </div>
              <div class="metric-number" data-value="25">0+</div>
              <div class="metric-label">Professional Staff</div>
            </div>
            <div class="metric-card">
              <div class="metric-image">
                <img
                  src="images/stats-professionals.jpg"
                  alt="Professional Staff"
                />
              </div>
              <div class="metric-number" data-value="34">0+</div>
              <div class="metric-label">Years of Experience</div>
            </div>
            <div class="metric-card">
              <div class="metric-image">
                <img src="images/stats-projects.jpg" alt="Projects Completed" />
              </div>
              <div class="metric-number" data-value="2000">0+</div>
              <div class="metric-label">Projects Completed</div>
            </div>
            <div class="metric-card">
              <div class="metric-image">
                <img src="images/stats-clients.jpg" alt="Client Satisfaction" />
              </div>
              <div class="metric-number" data-value="95">0%</div>
              <div class="metric-label">Client Satisfaction Rate</div>
            </div>
          </div>
        </div>
      </section>

      <section class="services-overview">
        <div class="container">
          <h2>Our Services</h2>
          <div class="services-grid">
            <!-- Card 1: Project Performance -->
            <div class="service-card">
              <img
                src="images/service-planning-scheduling.jpg"
                alt="Project Performance"
              />
              <h3>Project Performance</h3>
              <p>
                Ensure your projects are delivered successfully with our expert project performance services. We provide comprehensive support throughout the project lifecycle, from initial planning to final closeout.
              </p>
              <ul>
                <li>Project Planning & Scheduling</li>
                <li>Claims Avoidance & Management</li>
                <li>Earned Value Management System</li>
                <li>Risk Management</li>
              </ul>
              <a href="#project-performance-details" class="btn">Learn More</a>
            </div>
            <!-- Card 2: Data Transformation -->
            <div class="service-card">
              <img
                src="images/service-process-analytics.png"
                alt="Data Transformation"
              />
              <h3>Data Transformation</h3>
              <p>
                Unlock the power of your project data with our advanced data transformation solutions. We help you integrate disparate data sources, implement robust PMIS, and leverage cutting-edge analytics.
              </p>
              <ul>
                <li>PMIS</li>
                <li>Data Analytics</li>
                <li>AI/ML</li>
                <li>Virtual Design Construction (VDC)</li>
              </ul>
              <a href="#data-transformation-details" class="btn">Learn More</a>
            </div>
            <!-- Card 3: Cyber Security -->
            <div class="service-card">
              <img
                src="images/service-claims-management.jpg"
                alt="Cyber Security"
              />
              <h3>Cyber Security</h3>
              <p>
                Protect your critical assets and ensure regulatory compliance with our comprehensive cyber security services. We offer proactive security assessments, code reviews, and vulnerability management.
              </p>
              <ul>
                <li>Security Assessments</li>
                <li>Security Code Reviews</li>
                <li>Audit Support and Remediation</li>
                <li>Continuous Monitoring</li>
                <li>Vulnerability Management</li>
                <li>FISMA Reporting</li>
                <li>Security Documentation</li>
              </ul>
              <a href="#cyber-security-details" class="btn">Learn More</a>
            </div>
          </div>
        </div>
      </section>

      <!-- ===================================== -->
      <!-- Project Performance Details Section   -->
      <!-- ===================================== -->
      <section id="project-performance-details" class="service-detail-section animate-on-scroll">
         <div class="container"> <h2 class="detail-section-title">Project Performance</h2> </div>
          <!-- Overview -->
         <section class="service-section animate-on-scroll">
            <div class="container">
              <div class="service-banner">
                <img id="pp-overviewBanner" src="" alt="Project Performance Overview"/>
              </div>
              <div class="service-content">
                <h3 class="detail-subsection-title" id="pp-overviewTitle"></h3>
                <div id="pp-overviewParagraphs"></div>
              </div>
            </div>
         </section>
         
         <!-- Service Offerings -->
         <section class="service-section animate-on-scroll">
            <div class="container">
                <h3 class="detail-subsection-title" id="pp-serviceOfferingsTitle"></h3>
                <div class="service-offering-grid" id="pp-serviceOfferingsCards"></div>
            </div>
         </section>
          
         <!-- Approach -->
         <section class="service-section with-video animate-on-scroll">
             <video class="background-video" autoplay loop muted playsinline> <source src="images/video-process.webm" type="video/webm" /> </video>
             <div class="container">
                <h3 class="detail-subsection-title" id="pp-approachTitle"></h3>
                <div class="details-grid" id="pp-approachCards"></div>
             </div>
         </section>
      </section>

      <!-- ===================================== -->
      <!-- Data Transformation Details Section   -->
      <!-- ===================================== -->
       <section id="data-transformation-details" class="service-detail-section animate-on-scroll">
         <div class="container"> <h2 class="detail-section-title">Data Transformation</h2> </div>
          <!-- Overview -->
         <section class="service-section animate-on-scroll">
             <div class="container">
               <div class="service-banner">
                 <img id="dt-overviewBanner" src="" alt="Data Transformation Overview"/>
               </div>
               <div class="service-content">
                 <h3 class="detail-subsection-title" id="dt-overviewTitle"></h3>
                 <div id="dt-overviewParagraphs"></div>
               </div>
             </div>
          </section>
          
          <!-- Service Offerings -->
          <section class="service-section animate-on-scroll">
             <div class="container">
                 <h3 class="detail-subsection-title" id="dt-serviceOfferingsTitle"></h3>
                 <div class="service-offering-grid" id="dt-serviceOfferingsCards"></div>
             </div>
          </section>
          
          <!-- Approach -->
          <section class="service-section with-video animate-on-scroll">
              <video class="background-video" autoplay loop muted playsinline> <source src="images/video-scheduling.webm" type="video/webm" /> </video>
              <div class="container">
                 <h3 class="detail-subsection-title" id="dt-approachTitle"></h3>
                 <div class="details-grid" id="dt-approachCards"></div>
              </div>
          </section>
      </section>

      <!-- ===================================== -->
      <!-- Cyber Security Details Section        -->
      <!-- ===================================== -->
       <section id="cyber-security-details" class="service-detail-section animate-on-scroll">
          <div class="container"> <h2 class="detail-section-title">Cyber Security</h2> </div>
           <!-- Overview -->
          <section class="service-section animate-on-scroll">
              <div class="container">
                <div class="service-banner">
                  <img id="cs-overviewBanner" src="" alt="Cyber Security Overview"/>
                </div>
                <div class="service-content">
                  <h3 class="detail-subsection-title" id="cs-overviewTitle"></h3>
                  <div id="cs-overviewParagraphs"></div>
                </div>
              </div>
           </section>
           
           <!-- Service Offerings -->
           <section class="service-section animate-on-scroll">
              <div class="container">
                  <h3 class="detail-subsection-title" id="cs-serviceOfferingsTitle"></h3>
                  <div class="service-offering-grid" id="cs-serviceOfferingsCards"></div>
              </div>
           </section>
           
           <!-- Approach -->
           <section class="service-section with-video animate-on-scroll">
               <video class="background-video" autoplay loop muted playsinline> <source src="images/video-technology.webm" type="video/webm" /> </video>
               <div class="container">
                  <h3 class="detail-subsection-title" id="cs-approachTitle"></h3>
                  <div class="details-grid" id="cs-approachCards"></div>
               </div>
           </section>
       </section>

        <!-- ===================================== -->
        <!-- Combined FAQ Section                -->
        <!-- ===================================== -->
        <section id="combined-faq-section" class="faq-section animate-on-scroll">
            <div class="container">
                <h2>Frequently Asked Questions</h2>
                <div class="carousel combined-carousel"> <!-- Unique class -->
                    <div class="carousel-items" id="combined-faqItems"></div>
                    <div class="carousel-dots combined-dots"></div> <!-- Unique class -->
                </div>
            </div>
        </section>

        <!-- ===================================== -->
        <!-- Main CTA Section                    -->
        <!-- ===================================== -->
        <section id="main-cta-section" class="cta-section">
            <div class="container">
                <h2>Ready to Optimize Your Projects?</h2>
                <p>Contact us today to discuss your specific needs and learn how Critical Path Controls can help you achieve project success.</p>
                <!-- Ensure window.showGeneralModal() is the correct function for your general modal -->
                <a href="#" class="btn btn-large" onclick="window.showGeneralModal ? window.showGeneralModal() : console.error('showGeneralModal function not found'); return false;">Contact Us</a>
            </div>
        </section>

    </main>

    <!-- Include footer -->
    <div id="footer"></div>

    <!-- Include floating contact button -->
    <div id="floatingContact"></div>

    <!-- Include general contact form modal (already here) -->
    <div id="generalContactModal"></div>
    <!-- Include specific modals needed by the new CTAs -->
    <div id="projectPerformanceContactModal"></div>
    <div id="dataTransformationContactModal"></div>
    <div id="cyberSecurityContactModal"></div>


    <!-- Load scripts -->
    <script src="js/main.js"></script>
    <script src="js/storage-helper.js"></script>
    <script src="js/content-cache.js"></script>
    <script src="js/loader.js"></script>
    <script src="js/modal.js"></script>
    <!-- Script for Metrics Counter -->
    <script>
      // Metrics Counter Logic (from original index.js or similar)
       document.addEventListener("DOMContentLoaded", () => {
          const metrics = document.querySelectorAll(".metric-number");
          const observerOptions = { threshold: 0.1 }; // Trigger when 10% visible

          const animateValue = (element, start, end, duration) => {
              let startTimestamp = null;
              const step = (timestamp) => {
                  if (!startTimestamp) startTimestamp = timestamp;
                  const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                  let currentValue = Math.floor(progress * (end - start) + start);
                  // Append '+' or '%' if needed based on original text
                   if (element.textContent.includes('+')) {
                      element.textContent = currentValue + "+";
                  } else if (element.textContent.includes('%')) {
                       element.textContent = currentValue + "%";
                  } else {
                       element.textContent = currentValue;
                  }

                  if (progress < 1) {
                      window.requestAnimationFrame(step);
                  } else {
                       // Ensure final value is exact, with suffix
                      if (element.textContent.includes('+')) {
                          element.textContent = end + "+";
                      } else if (element.textContent.includes('%')) {
                          element.textContent = end + "%";
                      } else {
                          element.textContent = end;
                      }
                  }
              };
              window.requestAnimationFrame(step);
          };


          const observer = new IntersectionObserver((entries, observer) => {
              entries.forEach(entry => {
                  if (entry.isIntersecting) {
                      const element = entry.target;
                      const value = parseInt(element.getAttribute('data-value'), 10);
                      if (!isNaN(value)) {
                          animateValue(element, 0, value, 1500); // Animate over 1.5 seconds
                      }
                      observer.unobserve(element); // Stop observing once animated
                  }
              });
          }, observerOptions);

          metrics.forEach(metric => {
              observer.observe(metric);
          });
      });
    </script>
    <!-- Script for Loading Merged Content -->
    <script>
       document.addEventListener('DOMContentLoaded', function() {
           // --- Content Loading Configuration ---
           const contentSources = [
               { key: 'projectPerformance', file: 'content/project-performance.json', prefix: 'pp' },
               { key: 'dataTransformation', file: 'content/data-transformation.json', prefix: 'dt' },
               { key: 'cyberSecurity', file: 'content/cyber-security.json', prefix: 'cs' }
           ];

           // --- Helper Functions (Consolidated) ---
           function setText(selector, text) {
               const element = document.querySelector(selector);
               if (element && text) { element.textContent = text; }
               else if (!element && text) { console.warn(`Element not found for selector: ${selector}`); }
           }

           function setImageSource(selector, src, alt) {
               const element = document.querySelector(selector);
                if (element && src) {
                   element.src = src;
                   element.alt = alt || 'Service Image';
               } else if (!element && src) { console.warn(`Image element not found for selector: ${selector}`); }
               else if (element && !src) { console.warn(`Image source (src) not provided for selector: ${selector}`); }
           }

           function setParagraphs(containerSelector, paragraphs) {
               const container = document.querySelector(containerSelector);
               if (container && Array.isArray(paragraphs)) {
                   container.innerHTML = ''; // Clear existing
                   paragraphs.forEach(pText => {
                       const p = document.createElement('p');
                       p.textContent = pText;
                       container.appendChild(p);
                   });
               } else if (!container && paragraphs) { console.warn(`Paragraph container not found: ${containerSelector}`); }
           }

           function populateDetailCards(containerSelector, cards) {
               const container = document.querySelector(containerSelector);
               if (container && Array.isArray(cards)) {
                   container.innerHTML = ''; // Clear existing
                   cards.forEach(cardData => {
                       const card = document.createElement('div');
                       card.className = 'detail-card'; // Assuming 'detail-card' is the correct class for approach/general cards
                       let innerHTML = '';
                       if (cardData.icon) innerHTML += `<i class="${cardData.icon}"></i>`;
                       if (cardData.title) innerHTML += `<h3>${cardData.title}</h3>`;
                       if (cardData.description) innerHTML += `<p>${cardData.description}</p>`;
                       // DO NOT add 'Learn More' button here unless it's intended for approach cards
                       card.innerHTML = innerHTML;
                       container.appendChild(card);
                   });
               } else if (!container && cards) { console.warn(`Detail card container not found: ${containerSelector}`); }
           }

           // Specific function for service offering cards which include a link/button
           function populateServiceOfferingCards(containerSelector, cards) {
                const container = document.querySelector(containerSelector);
                if (container && Array.isArray(cards)) {
                    container.innerHTML = ''; // Clear existing
                    cards.forEach(cardData => {
                        const card = document.createElement('div');
                        // Using 'detail-card' class, adjust if service offerings have a different card class
                        card.className = 'detail-card service-offering-card'; // Add specific class if needed
                        let innerHTML = '';
                        if (cardData.icon) innerHTML += `<i class="${cardData.icon}"></i>`;
                        if (cardData.title) innerHTML += `<h3>${cardData.title}</h3>`;
                        if (cardData.description) innerHTML += `<p>${cardData.description}</p>`;
                         // Add the link specifically for service offerings
                         if (cardData.link) {
                              innerHTML += `<a href="${cardData.link}" class="btn">Learn More</a>`;
                         }
                        card.innerHTML = innerHTML;
                        container.appendChild(card);
                    });
                } else if (!container && cards) { console.warn(`Service offering card container not found: ${containerSelector}`); }
           }


          // Modified function to populate a single combined FAQ section
          function populateCombinedFaqItems(containerSelector, dotsSelector, allQuestions, carouselClass) {
               const container = document.querySelector(containerSelector);
               const dotsContainer = document.querySelector(dotsSelector);

               if (!container) { console.warn(`FAQ items container not found: ${containerSelector}`); return; }
               if (!dotsContainer) { console.warn(`FAQ dots container not found: ${dotsSelector}`); return; }

               if (Array.isArray(allQuestions) && allQuestions.length > 0) {
                   container.innerHTML = ''; // Clear existing items
                   dotsContainer.innerHTML = ''; // Clear existing dots

                   allQuestions.forEach((qData, index) => {
                       // Create Item
                       const item = document.createElement('div');
                       item.className = 'carousel-item';
                       if (index === 0) item.classList.add('active');
                       item.innerHTML = `<h4>${qData.question}</h4><p>${qData.answer}</p>`;
                       container.appendChild(item);

                       // Create Dot
                       const dot = document.createElement('span');
                       dot.className = 'carousel-dot';
                       if (index === 0) dot.classList.add('active');
                       dot.setAttribute('data-index', index);
                       dotsContainer.appendChild(dot);
                   });
                   console.log(`Populated ${allQuestions.length} combined FAQ items and dots for ${carouselClass}.`);

                   // Initialize this specific carousel
                   if (typeof window.initializeCarousel === 'function') {
                       const carouselElement = container.closest('.' + carouselClass);
                       if(carouselElement) {
                           console.log(`Initializing carousel: .${carouselClass}`);
                           window.initializeCarousel(carouselElement);
                       } else {
                           console.warn(`Could not find parent .${carouselClass} element for FAQ.`);
                       }
                   } else {
                       console.warn('initializeCarousel function not found or not ready. FAQ carousels might not work.');
                   }
               } else {
                   console.warn(`No FAQ items found in data for ${carouselClass}.`);
                   container.innerHTML = '<p>No frequently asked questions available at this time.</p>';
                   dotsContainer.innerHTML = '';
               }
           }

            // --- Load Content for Each Section ---
            let combinedFaqs = []; // Array to hold all FAQs
            let loadPromises = []; // Track loading promises

            contentSources.forEach(source => {
                 if (window.ContentCache) {
                     const promise = new Promise((resolve, reject) => {
                         // Force refresh by passing true as the third argument
                         ContentCache.loadContent(source.file, function(data) { 
                             if (!data || !data[source.key]) {
                                 console.error(`Failed to load or find content for key '${source.key}' in ${source.file}`);
                                 resolve(); // Resolve anyway to not block Promise.all
                                 return;
                             }
                             const pageData = data[source.key];
                             const prefix = '#' + source.prefix + '-'; // e.g., '#pp-'

                             // --- Debug Log for Banner Image --- 
                             console.log(`[${source.key}] Logging pageData.overview object:`, pageData.overview);
                              // ---------------------------------

                             // Populate content (excluding FAQs and CTAs)
                             setImageSource(prefix + 'overviewBanner', pageData.overview?.banner, pageData.hero?.title + ' Overview');
                             setText(prefix + 'overviewTitle', pageData.overview?.title);
                             setParagraphs(prefix + 'overviewParagraphs', pageData.overview?.paragraphs);

                             setText(prefix + 'serviceOfferingsTitle', pageData.serviceOfferings?.title);
                             populateServiceOfferingCards(prefix + 'serviceOfferingsCards', pageData.serviceOfferings?.cards);

                             setText(prefix + 'approachTitle', pageData.approach?.title);
                             populateDetailCards(prefix + 'approachCards', pageData.approach?.cards);

                             // Collect FAQs for combined section
                             if (pageData.faq && Array.isArray(pageData.faq.questions)) {
                                 combinedFaqs = combinedFaqs.concat(pageData.faq.questions);
                             }
                             
                             resolve(); // Resolve the promise for this file
                         }, true);
                     });
                     loadPromises.push(promise);
                 } else {
                      console.error('ContentCache not available. Cannot load dynamic content.');
                      // Handle case where ContentCache isn't available
                 }
            });

           // After all content files are processed, populate the combined FAQ section
           Promise.all(loadPromises).then(() => {
               console.log(`Total combined FAQs collected: ${combinedFaqs.length}`);
               populateCombinedFaqItems('#combined-faqItems', '.combined-dots', combinedFaqs, 'combined-carousel');
           }).catch(error => {
                console.error("Error processing content files:", error);
           });

           // Smooth scrolling for internal links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    const href = this.getAttribute('href');
                    // Ensure it's not just '#' and the target element exists
                    if (href.length > 1 && document.querySelector(href)) {
                         e.preventDefault();
                         document.querySelector(href).scrollIntoView({
                            behavior: 'smooth',
                             block: 'start' // Align to top
                         });
                    }
                });
            });
       });
   </script>

  </body>
</html>
